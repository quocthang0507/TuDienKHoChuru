function startUserMedia(n){var t=audio_context.createMediaStreamSource(n);console.log("Media stream created.");recorder=new Recorder(t);console.log("Recorder initialized.")}function startRecording(n){recorder&&recorder.record();n.disabled=!0;n.nextElementSibling.disabled=!1;console.log("Recording...")}function stopRecording(n){recorder&&recorder.stop();n.disabled=!0;n.previousElementSibling.disabled=!1;recorder&&recorder.exportWAV(n=>{validateAudio(n)});console.log("Stopped recording.");recorder.clear()}function validateAudio(n){switch(n.type){case"audio/wav":case"audio/mpeg":case"audio/ogg":break;default:alert("Không hỗ trợ các định dạng tập tin âm thanh khác, vui lòng chỉ chọn các tập tin có đuôi như sau: *.mp3, *.wav, *.ogg");audioBlob=null;return}var t=URL.createObjectURL(n),i=document.getElementById("audioPreview"),r=document.getElementById("audioSource");r.src=t;audioBlob=n;i.load()}function createInputMeaning(n){var t=document.createElement("input");return t.type="text",t.className="form-control",t.placeholder="Nhập nghĩa tại đây",t.name="Meaning",t.required=n,t}function addInputMeaning(){var t=document.getElementById("inputMeanings"),i=t.childElementCount;let n;n=i==0?createInputMeaning(!0):createInputMeaning(!1);t.appendChild(n);n.focus()}function removeInputMeaning(){var n=document.getElementById("inputMeanings");n.childElementCount>=2?n.removeChild(n.lastChild):alert("Một từ phải có ít nhất một nghĩa");n.lastChild.focus()}function validateImageFile(){var n=document.getElementById("inputImage"),t=n.value,i=/(\.jpg|\.png)$/i;if(n.files&&n.files[0]){if(!i.exec(t))return alert("Chỉ chấp nhận hình JPG và PNG!"),n.value="",!1;const r=n.files[0].size,u=Math.round(r/1024);return u>2048?(alert("Kích thước tập tin quá lớn, vui lòng gửi tập tin nhỏ hơn 2MB."),!1):!0}return!0}function showImagePreview(){return function(){if(validateImageFile()){var n=new FileReader;n.onload=function(n){document.getElementById("divImagePreview").innerHTML='<img class="imgPreview full-width" src="'+n.target.result+'"/>'};n.readAsDataURL(document.getElementById("inputImage").files[0])}}}function loadDictionaryNewType(){return function(){var n=$("#selectDictType").val();window.location="/ManageDictionary?dictTypeID="+n}}let audio_context,recorder,audioBlob=null;$(document).ready(function(){$("#selectDictType").change(loadDictionaryNewType());var n=$(".pagination li.prev"),t=$(".pagination li.next");t.click(function(){$("li.active").removeClass("active").next().addClass("active")});n.click(function(){$("li.active").removeClass("active").prev().addClass("active")});$("#inputImage").on("change",showImagePreview());try{window.AudioContext=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;window.URL=window.URL||window.webkitURL;audio_context=new AudioContext;console.log("AudioContext set up.");console.log("Navigator.getUserMedia "+(navigator.getUserMedia?"available.":"not present!"))}catch(i){alert("Trình duyệt này không hỗ trợ web audio!")}navigator.getUserMedia({audio:!0},startUserMedia,function(n){console.log("No live audio input: "+n);alert("Vui lòng cho chép trang web này sử dụng microphone của bạn, sau đó tải lại trang để cập nhật trạng thái.")});inputAudioFile.addEventListener("change",n=>validateAudio(n.target.files[0]));$("#formAddOrUpdateWord").submit(function(n){var u=document.getElementById("selectDictType").value,r=document.getElementsByName("WordID")[0].value,f=document.getElementsByName("Word")[0].value,e=validateImageFile(),i=$('[name="Meaning"]').map(function(){return{ID:0,WordID:r,Meaning:$(this).val()}}).get(),t;r?f?i.length!=0&&i[0].Meaning?e&&(t=new FormData(this),t.append("JSONMeanings",JSON.stringify(i)),t.append("AudioFile",audioBlob),t.append("DictType",u),$.ajax({method:"POST",url:$(this).attr("action"),data:t,cache:!1,contentType:!1,processData:!1,success:function(){alert("Lưu thành công")},error:function(n){console.error("Error: ",n);alert("Lỗi: "+n)}})):alert("Vui lòng nhập ít nhất một nghĩa cho từ này"):alert("Không được bỏ trống ô từ vựng"):alert("Thiếu ID từ");n.preventDefault()})});