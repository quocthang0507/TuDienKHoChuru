function showLog(n,t,i){n&&alert(t+" "+(i||""));console.log(t+" "+(i||""))}function startUserMedia(n){var t=audio_context.createMediaStreamSource(n);showLog(!1,"Media stream created.");recorder=new Recorder(t);showLog(!1,"Recorder initialized.")}function startRecording(n){recorder&&recorder.record();n.disabled=!0;n.nextElementSibling.disabled=!1;showLog(!1,"Recording...",null)}function stopRecording(n){recorder&&recorder.stop();n.disabled=!0;n.previousElementSibling.disabled=!1;recorder&&recorder.exportWAV(n=>{validateAudio(n)});showLog(!1,"Stopped recording.",null);recorder.clear()}function validateAudio(n){switch(n.type){case"audio/wav":case"audio/mpeg":case"audio/ogg":break;default:alert("Không hỗ trợ các định dạng tập tin âm thanh khác, vui lòng chỉ chọn các tập tin có đuôi như sau: *.mp3, *.wav, *.ogg");audioBlob=null;return}var t=URL.createObjectURL(n),i=document.getElementById("audioPreview"),r=document.getElementById("audioSource");r.src=t;audioBlob=n;i.load()}function createInputMeaning(n){var t=document.createElement("input");return t.type="text",t.className="form-control",t.placeholder="Nhập nghĩa tại đây",t.name="Meaning",t.required=n,t}function addInputMeaning(){var t=document.getElementById("inputMeanings"),i=t.childElementCount;let n;n=i==0?createInputMeaning(!0):createInputMeaning(!1);t.appendChild(n);n.focus()}function removeInputMeaning(){var n=document.getElementById("inputMeanings");n.childElementCount>=2?n.removeChild(n.lastChild):alert("Một từ phải có ít nhất một nghĩa")}function validateImageFile(){var n=document.querySelector("[type=file]"),t=n.value;if(n.files&&n.files[0]){if(/(\.jpg|\.png)$/i.exec(t)){const t=n.files[0].size,i=Math.round(t/1024);return i>2048?(alert("Kích thước tập tin quá lớn, vui lòng gửi tập tin nhỏ hơn 2MB."),null):n.files[0]}alert("Chỉ chấp nhận hình JPG và PNG!");n.value=""}return null}function showImagePreview(){return function(){var t=validateImageFile(),n;t!==!1&&(n=new FileReader,n.onload=function(n){document.getElementById("divImagePreview").innerHTML='<img class="imgPreview full-width" src="'+n.target.result+'"/>'},n.readAsDataURL(t))}}function loadDictionaryNewType(){return function(){var n=$("#selectDictType").val();window.location="/ManageDictionary?dictTypeID="+n}}function handleSubmitForm(n){var u;n.preventDefault();var t=new FormData,i=document.getElementsByName("WordID")[0].value,r=document.getElementsByName("Word")[0].value,f=document.getElementsByName("WordTypeID")[0].value,e=validateImageFile(),o=$("#formAddOrUpdateWord").map(function(){return{WordID:i,Meaning:$(this).find('[name="Meaning"]').value}});i&&r&&o?(u=window.location.origin+"/api/AddOrUpdateWord",t.append("WordID",i),t.append("Word",r),t.append("WordTypeID",f),t.append("ImageFile",e),t.append("AudioFile",audioBlob),fetch(u,{method:"POST",body:t}).then(n=>n.text()).then(n=>{showLog(!0,n?JSON.parse(n):{})}).catch(n=>{console.error(n),showLog(!0,n)})):showLog(!0,"Vui lòng kiểm tra lại dữ liệu nhập vào")}var audio_context,recorder,audioBlob;$(document).ready(function(){$("#selectDictType").change(loadDictionaryNewType());var n=$(".pagination li.prev"),t=$(".pagination li.next");t.click(function(){$("li.active").removeClass("active").next().addClass("active")});n.click(function(){$("li.active").removeClass("active").prev().addClass("active")});$("#inputImage").on("change",showImagePreview());try{window.AudioContext=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;window.URL=window.URL||window.webkitURL;audio_context=new AudioContext;showLog(!1,"AudioContext set up.");showLog(!1,"navigator.getUserMedia "+(navigator.getUserMedia?"available.":"not present!"))}catch(r){alert("Trình duyệt này không hỗ trợ web audio!")}navigator.getUserMedia({audio:!0},startUserMedia,function(n){showLog("No live audio input: "+n);alert("Vui lòng cho chép trang web này sử dụng microphone của bạn, sau đó tải lại trang để cập nhật trạng thái.")});inputAudioFile.addEventListener("change",n=>validateAudio(n.target.files[0]));let i=document.getElementById("formAddOrUpdateWord");i.addEventListener("submit",n=>handleSubmitForm(n))});