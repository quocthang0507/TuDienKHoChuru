function startUserMedia(n){var t=audio_context.createMediaStreamSource(n);console.log("Media stream created.");recorder=new Recorder(t);console.log("Recorder initialized.")}function startRecording(n){audio_context&&(recorder&&recorder.record(),n.style.display="none",btnStop.style.display="initial",console.log("Recording..."))}function stopRecording(n){recorder&&recorder.stop();n.style.display="none";btnStart.style.display="initial";recorder&&recorder.exportWAV(n=>{validateAudio(n)});console.log("Stopped recording.");recorder.clear()}function validateAudio(n){switch(n.type){case"audio/wav":case"audio/mpeg":case"audio/ogg":break;default:alert("Không hỗ trợ các định dạng tập tin âm thanh khác, vui lòng chỉ chọn các tập tin có đuôi như sau: *.mp3, *.wav, *.ogg");audioBlob=null;return}var t=URL.createObjectURL(n),i=document.getElementById("audioPreview"),r=document.getElementById("audioSource");r.src=t;audioBlob=n;i.load()}function eventChangeDictType(){return function(){var n=$("#selectDictType").val();window.location.href=window.location.origin+`/Passage/${n}/1`}}function insertPassage(){loaderOn();var t=$("#ID").get(0).innerHTML,i=$("#selectDictType").get(0).value,r=$('[name="PassageType"]').get(0).value,u=$('[name="Source"]').get(0).value,f=$('[name="Destination"]').get(0).value,n=new FormData;isNumeric(t)?n.append("ID",t):n.append("ID",0);n.append("DictType",i);n.append("PassageType",r);n.append("Source",u);n.append("Destination",f);n.append("AudioFile",audioBlob);$.ajax({method:"POST",url:window.location.origin+"/api/InsertPassage",data:n,cache:!1,contentType:!1,processData:!1,success:function(){location.reload()},error:function(){loaderOff();showSnackbar("Lỗi: Đã xảy ra lỗi khi nhận yêu cầu chèn đoạn văn song ngữ này")}});loaderOff()}function updatePassage(n,t){$("#ID").get(0).innerHTML=$(`#ID${n}`).get(0).innerHTML;$('[name="PassageType"]').get(0).value=t;$('[name="Source"]').get(0).value=$("#source"+n).get(0).innerHTML;$('[name="Destination"]').get(0).value=$("#destination"+n).get(0).innerHTML;$('[name="PronouncePath"]').get(0).value=$("#pronounce"+n).get(0).innerHTML;btnInsert.style.display="none";btnSave.style.display=""}async function deletePassage(n){confirm("Bạn có muốn xóa đoạn văn song ngữ này không?")&&(loaderOn(),$.ajax({method:"GET",url:window.location.origin+"/api/DeletePassage/"+n,success:function(){location.reload()},error:function(){loaderOff();showSnackbar("Lỗi: Đã xảy ra lỗi khi nhận yêu cầu xoá đoạn văn song ngữ này")}}))}function initializeAudio(){try{window.AudioContext=window.AudioContext||window.webkitAudioContext;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia;window.URL=window.URL||window.webkitURL;audio_context=new AudioContext;console.log("AudioContext set up.");console.log("Navigator.getUserMedia "+(navigator.getUserMedia?"available.":"not present!"))}catch(n){return alert("Trình duyệt này không hỗ trợ web audio!"),!1}return navigator.getUserMedia({audio:!0},startUserMedia,function(n){return console.log("No live audio input: "+n),alert("Vui lòng cho chép trang web này sử dụng microphone của bạn, sau đó tải lại trang để cập nhật trạng thái."),!1}),!0}var audio_context,recorder,audioBlob=null;window.onload=function(){initializeAudio()||(audio_context=null)};$(document).ready(function(){$("#selectDictType").change(eventChangeDictType())});