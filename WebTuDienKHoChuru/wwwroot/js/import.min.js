function checkCsvExt(n){return/(\.csv)$/i.exec(n)}function onInputChange(n){var i=inputCSV.value,t;inputCSV.files&&inputCSV.files[0]&&(checkCsvExt(i)?(captionInput.innerHTML=i.replace(/.*[\/\\]/,""),t=new FileReader,t.onload=function(t){showCsvFile(t.target.result);btnUpload.addEventListener("click",function(){submitCsvFile(inputCSV.files[0],n)})},t.readAsText(inputCSV.files[0])):(showSnackbar("Cảnh báo: Chỉ chấp nhận tập tin CSV!"),inputCSV.value=""))}function dropHandler(n,t){if(n.preventDefault(),n.dataTransfer.items)if(n.dataTransfer.items.length!=1)showSnackbar("Chỉ nhận một tập tin thả vào đây thôi!");else if(n.dataTransfer.items[0].kind==="file"){var i=n.dataTransfer.items[0].getAsFile();checkCsvExt(i.name)?(i.text().then(n=>showCsvFile(n)),captionInput.innerHTML=i.name,btnUpload.addEventListener("click",function(){submitCsvFile(i,t)})):showSnackbar("Cảnh báo: Tập tin đã thả vào đây không phải là tập tin có phần mở rộng CSV")}}function dragOverHandler(n){dropZone.style.backgroundColor="#c8dadf";n.preventDefault()}function dropLeaveHandler(n){dropZone.style.backgroundColor="#ffffff";n.preventDefault()}function showCsvFile(n){var e,r,o;$("table").remove();var t=d3.csvParseRows(n),i=d3.select("#csvTable").append("table").attr("class","table table-hover table-bordered table-sm tableFixHead").attr("id","previewCSV"),u=i.append("thead").attr("scope","col"),f=i.append("tbody");return t[0].unshift("STT"),e=u.append("tr").selectAll("th").data(t[0]).enter().append("th").text(function(n){return n}),t.shift(),t.forEach((n,t)=>{n.unshift(t+1)}),r=f.selectAll("tr").data(t).enter().append("tr"),o=r.selectAll("td").data(function(n){return n}).enter().append("td").text(function(n){return n}),totalRows.innerHTML=`Có tổng cộng ${t.length} dòng`,csvTable.style.display="",i}function parseCsvPath(n){d3.csv(n,function(n,t){if(n){showSnackbar("Lỗi định dạng tập tin CSV!");return}showCsvFile(t);$("html, body").animate({scrollTop:$("#previewCSV").offset().top},2e3)})}function highlightRow(n){var i=document.getElementById("previewCSV"),r=i.rows,t;for(totalRows.innerHTML+=` và ${n.length} dòng bị lỗi. Vui lòng chỉnh sửa lại các dòng này và thử tải lên tập tin này một lần nữa`,t=0;t<n.length;t++)r[n[t]+1].classList.add("table-danger");$("html, body").animate({scrollTop:$("#previewCSV").offset().top},1e3)}function submitCsvFile(n,t){if(confirm("Bạn có muốn nhập các từ này vào hệ thống không? Lưu ý: Các từ có thể bị trùng sau khi nhập")){loaderOn();var i=new FormData;i.append("csvFile",n);i.append("dictTypeID",t);$.ajax({method:"POST",url:window.location.origin+"/api/Import",data:i,cache:!1,contentType:!1,processData:!1,success:function(){loaderOff();showSnackbar("Thông báo: Thêm thành công vào cơ sở dữ liệu")},error:function(n,t,i){loaderOff();n.responseJSON&&highlightRow(n.responseJSON);console.error("Error: ",i)}})}}