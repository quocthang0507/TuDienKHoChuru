function checkTsvExt(n){return/\.(tsv|txt)$/i.exec(n)}function onInputChange(n){var i=inputTSV.value,r,t;inputTSV.files&&inputTSV.files[0]&&(checkTsvExt(i)?(r=inputTSV.files[0].size/1024,captionInput.innerHTML=i.replace(/.*[\/\\]/,""),btnUpload.style.display="initial",r<=maxSizePreview&&(loaderOn(),t=new FileReader,t.onload=function(t){showTsvFile(t.target.result);loaderOff();btnUpload.addEventListener("click",function(){submitTsvFile(inputTSV.files[0],n)})},t.readAsText(inputTSV.files[0]))):(showSnackbar("Cảnh báo: Chỉ chấp nhận tập tin .txt hoặc .tsv!"),inputTSV.value=""))}function dropHandler(n,t){var i,r;n.preventDefault();n.dataTransfer.items&&(n.dataTransfer.items.length!=1?showSnackbar("Chỉ nhận một tập tin thả vào đây thôi!"):n.dataTransfer.items[0].kind==="file"&&(i=n.dataTransfer.items[0].getAsFile(),checkTsvExt(i.name)?(r=i.size/1024,r<=maxSizePreview&&(loaderOn(),i.text().then(n=>{showTsvFile(n),loaderOff()})),btnUpload.style.display="initial",captionInput.innerHTML=i.name,btnUpload.addEventListener("click",function(){submitTsvFile(i,t)})):showSnackbar("Cảnh báo: Tập tin đã thả vào đây không phải là tập tin có phần mở rộng .tsv hay .txt")))}function dragOverHandler(n){dropZone.style.backgroundColor="#c8dadf";n.preventDefault()}function dropLeaveHandler(n){dropZone.style.backgroundColor="#ffffff";n.preventDefault()}function showTsvFile(n){var e,r,o;$("table").remove();var t=d3.tsvParseRows(n),i=d3.select("#tsvTable").append("table").attr("class","table table-hover table-bordered table-sm tableFixHead").attr("id","previewTSV"),u=i.append("thead").attr("scope","col"),f=i.append("tbody");return t[0].unshift("STT"),e=u.append("tr").selectAll("th").data(t[0]).enter().append("th").text(function(n){return n}),t.shift(),t.forEach((n,t)=>{n.unshift(t+1)}),r=f.selectAll("tr").data(t).enter().append("tr"),o=r.selectAll("td").data(function(n){return n}).enter().append("td").text(function(n){return n}),totalRows.innerHTML=`Có tổng cộng ${t.length} dòng`,tsvTable.style.display="initial",i}function highlightRow(n){var i=document.getElementById("previewTSV"),r=i.rows,t;for(totalRows.innerHTML+=` và ${n.length} dòng bị lỗi. Vui lòng chỉnh sửa lại các dòng này và thử tải lên tập tin này một lần nữa`,t=0;t<n.length;t++)r[n[t]+1].classList.add("table-danger");$("html, body").animate({scrollTop:$("#previewTSV").offset().top},1e3)}function submitTsvFile(n,t){if(confirm("Bạn có muốn nhập các từ này vào hệ thống không? Lưu ý: Các từ có thể bị trùng sau khi nhập")){loaderOn();url=window.location.origin+"/api/ImportDictionary";var i=new FormData;i.append("tsvFile",n);i.append("dictTypeID",t);$.ajax({method:"POST",url:url,data:i,cache:!1,contentType:!1,processData:!1,success:function(){loaderOff();showSnackbar("Thông báo: Thêm thành công vào cơ sở dữ liệu")},error:function(n,t,i){loaderOff();n.responseJSON?highlightRow(n.responseJSON):(showSnackbar("Lỗi: "+n.responseText),console.error("Error: ",i))}})}}const maxSizePreview=50;